ISSN 0868–5886                                            НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3, c. 25–31

300 лет Санкт-Петербургу
 Материалы XXXII конференции СПбГИТМО(ТУ)

УДК 681.2

 А. О. Голубок, А. Е. Платунов, И. Д. Сапожников

СИСТЕМА  УПРАВЛЕНИЯ  СКАНИРУЮЩИМ  ЗОНДОВЫМ
МИКРОСКОПОМ

В статье рассматривается современный вариант реализации системы управления сканирующим зондовым
микроскопом. В его основе лежит высокопроизводительный программируемый приборный контроллер ска-
нирующего зондового микроскопа (КСЗМ) на базе модулей MEC5091 и ADEPT. В качестве консоли управ-
ления, отображения и средства вторичной обработки выступает персональный компьютер. Наличие системы
программирования дает возможность описывать алгоритм управления СЗМ на языке SPML.

ВВЕДЕНИЕ составляет высокопроизводительный программи-
руемый приборный контроллер сканирующего

Сканирующий зондовый микроскоп (СЗМ) яв- зондового микроскопа (КСЗМ), который в качест-
ляется одним из базовых инструментов нанотех- ве консоли управления, отображения и вторичной
нологии, поскольку он обеспечивает визуализа- обработки использует персональный компьютер
цию, диагностику и модификацию микро- и нано- (ПК) с соответствующим инструментальным
структур с прецизионным уровнем пространст- и прикладным программным обеспечением.
венного разрешения вплоть до атомных масшта- Структурная схема системы управления СЗМ
бов [1]. Современный СЗМ оснащен разнообраз- с аналоговой петлей обратной связи представлена
ными измерительными режимами (модами), среди на рис. 1. Зонд 1, соединенный с датчиком взаи-
которых: туннельная микроскопия и спектроско- модействия 4, может работать в режимах скани-
пия, силовая микроскопия, в том числе микроско- рующего туннельного микроскопа (СТМ) или ска-
пия магнитных и электростатических сил, элек- нирующего силового микроскопа (ССМ). Датчи-
трохимическая микроскопия, акустическая микро- ком взаимодействия для ССМ может служить кан-
скопия, оптическая микроскопия ближнего поля тилевер (cantilever) c оптической регистрацией уг-
и т. п. Кроме того, в СЗМ могут быть реализованы ла отклонения, пьезоэлемент или другой преобра-
различные методы токовой и силовой нанолито- зователь механического перемещения в электри-
графии. Наконец, следует отметить, что в зависи- ческий сигнал. Датчиком туннельного тока для
мости от характера решаемых задач СЗМ может СТМ является проводящий зонд с преобразовате-
функционировать на воздухе при атмосферном лем тока в напряжение.
давлении, в газовой среде заданного состава, В случае ССМ в полуконтактной моде генера-
в жидкости, в том числе криогенной, в условиях тор 7 выдает синусоидальное напряжение на пье-
сверхвысокого вакуума. Конструкции физических зовибратор 3, к которому присоединен зонд 1
узлов СЗМ во многом определяются средой функ- в виде острой иглы или стандартного кантилевера.
ционирования прибора и набором измерительных Зонд раскачивается вибратором на частоте меха-
мод, поэтому трудно говорить в широком смысле об нического резонанса. Сигнал с датчика 4 поступа-
универсальном физическом узле СЗМ. Вместе с тем ет на синхронный детектор 10, где выделяется ам-
в силу единого алгоритма работы физических уз- плитуда и фаза сигнала на опорной частоте гене-
лов  различных конструкций управление прибо- ратора 7. Сигнал, пропорциональный амплитуде
ром, сбор, обработка, отображение и хранение ин- колебаний зонда, характеризует величину силово-
формации могут быть осуществлены с помощью го взаимодействия; он поступает на дифференци-
универсальной системы управления (СУ СЗМ). альный усилитель 11 в качестве входного сигнала

петли обратной связи.
СТРУКТУРА И ОСНОВНЫЕ ФУНКЦИИ В случае ССМ в контактной или бесконтактной

СИСТЕМЫ УПРАВЛЕНИЯ СЗМ моде генератор 7 не включается, а отклонение
кантилевера регистрируется оптической системой

Система управления СЗМ реализуется в виде с фотоприемником, электрический сигнал с кото-
специализированного вычислительного комплекса рого после усиления поступает на дифференци-
и ряда аналоговых устройств. Основу комплекса альный усилитель 11 через ключ К (рис. 1).

25



26 А. О. ГОЛУБОК, А. Е. ПЛАТУНОВ, И. Д. САПОЖНИКОВ

К

10 11 12 13

3
4

1
7

2  14
     15

X,Y, 8
5

Z 9
         6

Рис. 1. Структурная схема СУ СЗМ.
1 — зонд; 2 — образец; 3 — пьезовибратор; 4 — датчик взаимодействия; 5 — сканер X, Y, Z; 6 —
система сближения зонда с образцом; 7 — генератор синусоидального напряжения; 8, 9 — высоко-
вольтные усилители; 10 — синхронный детектор; 11 — дифференциальный усилитель; 12 — интегра-
тор; 13 — усилитель напряжения; 14 — персональный компьютер; 15 — контроллер КСЗМ

В случае СТМ напряжение, пропорциональное ной величины взаимодействия, измерение и по-
туннельному току, поступает на дифференциаль- строение графиков  зависимости амплитуды коле-
ный усилитель 11 через ключ К, показанный на баний зонда от зазора —  A(Z) (силовая спектро-
рис. 1. скопия).

СУ СЗМ работает в трех основных режимах:
• настройка системы; Сканирование
• сближение зонда с образцом, захват взаи-

модействия; В этом режиме производится сканирование по
• сканирование; выбранной площади с визуализацией и сохранени-

ем получаемых в процессе сканирования данных.
• спектроскопия. Результатом сканирования являются:

• построение СЗМ изображения — Z(X, Y)
Настройка системы (топография поверхности);

В этом режиме производятся начальные уста- • построение карты распределения тун-
новки аппаратуры, установление связи ПК нельного тока — It(X, Y);
с КСЗМ, снятие АЧХ системы вибратор—зонд, • построение карты распределения ампли-
настройка на частоту механического резонанса, туды сигнала A(X, Y), пропорциональной  величи-
вывод изображения зонда с видеокамеры для кон- не силового взаимодействия F(X, Y);
троля предварительного сближения с образцом • построение карты распределения фазово-
и т. п. го сдвига φ(X, Y) между опорным сигналом гене-

ратора и сигналом с датчика взаимодействия;
Сближение зонда с образцом, • литографирование (силовое и электриче-

захват взаимодействия скими импульсами) по заранее выбранному ри-
В этом режиме производится установка на- сунку.

чальных параметров сближения, визуализация
сигналов в процессе сближения на экране ПК, Спектроскопия
управление двух- или четырехфазным шаговым Этот режим может реализовываться после за-
двигателем, автоматический вывод сканера в ра- хвата взаимодействия без сканирования либо при
бочее положение по оси Z при достижении задан- сканировании в заранее выбранных на поле скани-

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3



СИСТЕМА  УПРАВЛЕНИЯ  СКАНИРУЮЩИМ  ЗОНДОВЫМ  МИКРОСКОПОМ 27

рования точках. В каждой точке производится Следует отметить, что структура КСЗМ позво-
развертка напряжения в ЦАП, управляющем из- ляет нарастить его вычислительные ресурсы
менением зазора между зондом и образцом. В слу- и реализовать цифровую петлю обратной связи
чае силовой спектроскопии производится измере- для СЗМ, что обеспечит гибкость настройки АЧХ
ние и построение зависимости  A(Z)  при отклю- для разнообразных режимов и различных физиче-
ченной петле обратной связи. В случае туннель- ских узлов, уменьшит долю аналоговых электрон-
ной спектроскопии производится измерение и по- ных компонентов, а также позволит использовать
строение вольт-амперных характеристик It(U) и их методы цифровой фильтрации.
производных при отключенной петле обратной КСЗМ — конфигурируемая модульная мульти-
связи. процессорная система, обеспечивающая опти-

Особенностью работы СУ СЗМ является то, что мальную настройку системы и легко позволяющая
параметры режимов, в том числе путь сканирова- дополнять СЗМ новыми методиками.
ния, графический файл рисунка для литографии, В состав КСЗМ входят плата основного вычис-
частотный диапазон поиска механического резо- лителя MEC5091 (вычислительное ядро, микро-
нанса  колебаний зонда и т. п., вводятся пользова- схемы программируемой логики, память, им-
телем в КСЗМ заранее, после этого КСЗМ выпол- пульсные источники питания) и плата аналогового
няет один из вышеописанных режимов в реальном ввода—вывода ADEPT (АЦП и ЦАП, источники
времени.  Кроме того, пользователь может изме- питания аналого-цифровых блоков) [1, 2]. Задача
нять некоторые параметры (например, величину обеспечения интерфейсов аналого-цифрового вво-
взаимодействия, коэффициенты усиления, вели- да—вывода решается специальными операцион-
чину напряжения смещения на образце, скорость ными блоками на базе программируемой логики.
сканирования), прерывая выполнение описанных Прикладные алгоритмы выполняются совместно
выше режимов. специализированным RISC-процессором и стан-

Описанное построение СУ СЗМ позволяет дартным коммуникационным микроконтроллером.
пользоваться во время сканирования компьютером Для передачи результатов сканирования и инфор-
(ПК), в том числе Интернетом, просматривать мации виртуальных осциллографов реализованы
файлы, использовать Web-камеру. Минимальное высокопроизводительные информационные трак-
время сканирования кадра размером 100 × 100 то-
чек составляет 0.5 секунды, максимальное — бо- ты на базе программируемой логики с использо-
лее одного часа. ванием механизма SmartDMA коммуникационного

микроконтроллера Am186CC. Вычислительное
ядро контроллера работает под управлением опе-

КОНТРОЛЛЕР СЗМ рационной среды реального времени с поддерж-
кой файлового ввода—вывода и обмена по интер-

Центральное место в СУ СТМ занимает кон- фейсу USB. Контроллер поддерживает внутрисис-
троллер СЗМ, соединенный с персональным ком- темное программирование, что позволяет опера-
пьютером по интерфейсу USB. КСЗМ выполняет тивно обновлять встроенное программное обеспе-
следующие функции: чение микроконтроллера и конфигурационные

• связь с управляющим компьютером; данные ПЛИС без участия разработчиков кон-
• выдача  цифровых сигналов для управле- троллера и не требует специальных программато-

ния аналоговыми ключами по программе от ПК; ров.
• выдача цифровых сигналов по независи- В настоящее время создан ряд вариантов сис-

мым временным диаграммам для управления циф- темы управления СЗМ на базе модулей MEC5091
ровыми потенциометрами усилителей, син- и ADEPT. Исследования продолжаются по сле-
хронного детектора, генератора синусоидального дующим направлениям: оптимизация следящей
сигнала и т. п.; системы СЗМ, развитие инструментальных

• обеспечение работы двух независимых средств для прикладного программирования рабо-
АЦП и шести ЦАП для работы СУ СЗМ в различ- чих элементов СЗМ, развитие средств обработки
ных режимах; результатов сканирования.

• сканирование посредством двух ЦАП по
осям X и Y в "реальном времени" с одновременной Модуль MEC5091
передачей буферированных данных в ПК; Модули (контроллеры) серии MEC5091 содер-

• выполнение алгоритмов пользователя жат коммуникационный процессор семейства x86
в процессе сканирования (например, спектроско- и периферийный RISC-процессор на базе ПЛИС
пии); [2]. Контроллер оснащен большим количеством

• обеспечение работы виртуального осцилло- различных интерфейсов ввода—вывода: CAN,
графа одновременно с передачей в ПК данных — RS232, IrDA, USB, что позволяет подключать его
результатов сканирования. не только к обычному персональному компьюте-

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3



28 А. О. ГОЛУБОК, А. Е. ПЛАТУНОВ, И. Д. САПОЖНИКОВ

ру, но и к самому разнообразному оборудованию. клеммы). Система питания обеспечивает напряже-
MEC5091 можно использовать в различных  про- ния 3.3 В для блока бортового вычислителя и 2.5 В
мышленных и приборных системах. Основное на- для блока системного расширения. При отсутст-
значение MEC5091 — работа в составе встроен- вии одного из блоков система питания может быть
ных систем: бортовых управляющих ЭВМ, прибо- упрощена, что дополнительно понизит энергопо-
ров, измерительных и исследовательских ком- требление и расширит температурный диапазон
плексов. Модульность систем на базе MEC5091 работы платы.
обеспечивается за счет использования промыш-
ленной шины PC104 (ISA). Программируемая ло- Модуль ADEPT
гика в составе MEC5091 делает возможным кон-
фигурирование аппаратной части системы в соот- Модуль ADEPT (см. таблицу) предназначен для
ветствии с требованиями заказчика. аналогового и дискретного ввода—вывода в сис-

Основные характеристики контроллеров серии темах стандарта PC104. Модуль обладает разви-
MEC5091: тыми возможностями предварительной обработки

сигналов. Это обеспечивается использованием
• шина PC104; программируемой логики высокой степени инте-
• канал USB (12 Мбит, slave); грации фирмы Altera в сочетании с буферной па-
• порт RS232 (до 115200 бит/с, гальваниче- мятью (FLASH, SDRAM). Предусмотрена воз-

ски изолированный); можность загрузки пользователем конфигураци-
• IrDA (2400–115200 бит/с); онных файлов ПЛИС, что позволяет формировать
• 2 канала CAN (SJA1000, до 1 Мбит/с, не- и гибко изменять функции устройства обработки

зависимые, гальванически изолированные); входных и выходных сигналов в модуле. Модуль
• 30 дискретных каналов ввода—вывода ADEPT оснащен контроллерами таких популяр-

общего назначения (70 дискретных каналов, если ных интерфейсов, как PC104, USB, IDE-ATA и др.
не использовать шину PC104).

Устройство состоит из следующих частей.
• Блок бортового вычислителя. Ядром являет- СИСТЕМА ПОЛЬЗОВАТЕЛЬСКОГО

ся коммуникационный процессор Am186CC или ПРОГРАММИРОВАНИЯ
Am186CU. Блок предназначен для выполнения
определенных алгоритмов и обеспечения интер- Для отделения пользовательских задач от сис-
фейсов USB и RS232. В полной комплектации темных в модуле MEC5091 контроллера КСЗМ
устройства данный блок играет ведущую роль и использована виртуальная машина с оригинальной
может обеспечивать дополнительный интерфейс системой команд [3, 4]. Частично виртуальная
IrDA. машина реализована программно, а частично ап-

• Блок системного расширения. Ядром его яв- паратно. Использование виртуальной машины по-
ляется устройство программируемой логики фир- зволило:
мы Altera ACEX EP1K30 или EP1K100. Блок обес- • обеспечить эффективную поддержку ре-
печивает дополнительные интерфейсы расшире- жима реального времени;
ния (IrDA, PS/2), инструментальные (JTAG, I/O), • скрыть от прикладного программиста
системные (мост PC104). Выполняет вспомога- взаимодействие со сложной аппаратурой;
тельные функции при работе блока бортового вы- • увеличить надежность системы;
числителя, однако в случае отсутствия последнего • ускорить цикл разработки пользователь-
может работать самостоятельно (для самостоя- ских программ.
тельной работы необходимо наличие загрузочного Алгоритмы управления сканирующим зондо-
EEPROM). Одной из важных функций данного вым микроскопом задаются пользователем (рис. 2)
блока является начальное внутрисхемное про- посредством языка высокого уровня CSPML [5].
граммирование общих ресурсов (RTC, FLASH). Внешне язык CSPML похож на язык программи-

• Блок общих ресурсов. Он предоставляет рования C, что делает процесс его освоения про-
доступ к ресурсам памяти (SRAM и FLASH), а граммистами достаточно простым. Язык содержит
также RTC. Содержит в своем составе супервизор средства описания констант и переменных, услов-
питания. Обеспечивает два гальванически изоли- ные операторы, операторы циклов, функции.
рованных интерфейса CAN. Можно использовать несколько типов данных,

• Система питания. Система предназначена есть возможность использования препроцессора.
для обеспечения питанием всего устройства. Пре- Алгоритм можно описывать не только на вы-
дусмотрено два варианта питания: от внешнего сокоуровневом языке, но и на языке ассемблера,
источника постоянного тока напряжением 5 В (че- в который преобразуется программа перед пре-
рез разъем PC104 или через специальные клеммы) образованием в бинарный вид. Ассемблерные
или напряжением 8 … 36 В (через специальные вставки  начинаются  с зарезервированного слова

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3



СИСТЕМА  УПРАВЛЕНИЯ  СКАНИРУЮЩИМ  ЗОНДОВЫМ  МИКРОСКОПОМ 29

Основные характеристики модуля ADEPT

Наименование Значение

Дискретные входы—выходы   ТТЛ, до 32 линий

Аналоговые входы 12 бит, (200 kHz), –10…+10 В, 8 линий;

16 бит, (200 kHz), –10…+10 В, 1 линия

Аналоговые выходы 12 бит, (300 kHz), –5…+5 В, 2 линии;
16 бит, (200 kHz), –10…+10 В, 4 линии

Процессор предварительной обработки на базе FPGA фирмы Altera EP1K30, ..., EP1K100

Контроллер USB USBN9603

Память Flash — 1 Мбайт, SDRAM — до 32 Мбайт

Системные устройства WDT, Ser EEPROM, генератор 48 МГц

Питание + 5 В, + 15 В, –15 В

Исходный текст

Транслятор Исполняемый
код Отладчик

Загрузчик

Рис. 2. Процесс создания программы управления зондовым микроскопом

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3

Контроллер



30 А. О. ГОЛУБОК, А. Е. ПЛАТУНОВ, И. Д. САПОЖНИКОВ

‘ASM-START’ и заканчиваются словом ‘ASM-END’. 2. Чистяков А.Г., Платунов А.Е. Проектирование
Внутри ассемблерной вставки находятся строки, функционального наполнения ПЛИС в составе
содержащие не более одной команды. Также мож- цифровых программно-аппаратных комплек-
но обращаться к глобальным и локальным пере- сов // Тезисы докладов IX Санкт-Петер-
менным. Данную возможность компилятора сле- бургской ассамблеи молодых ученых и спе-
дует использовать только подготовленным поль- циалистов. СПб.: Изд-во СПбГПУ, 1999. С. 53.
зователям. 3. Ковязин Р.Р., Чистяков А.Г. Использование

аппаратных интерпретаторов для управления
ЗАКЛЮЧЕНИЕ неоднородными компонентами микропроцес-

сорной системы // Научно-технический вест-
Система управления сканирующим зондовым ник СПбГИТМО (ТУ): Информационные, вы-

микроскопом на основе конфигурируемых моду- числительные и управляющие системы / Гл.
лей MEC5091 и  ADEPT, которые оснащены мно- ред. В.Н. Васильев. СПб.: Изд-во СПбГИТМО
гоуровневой системой пользовательского про- (ТУ), 2002. Вып. 6. С. 71–76.
граммирования, является примером удачного ис- 4. Ковязин Р.Р. Оптимизация исполняемого кода
пользования концепции платформно-ориенти- для виртуальной машины // Тезисы докладов
рованного проектирования в области встроенных VI Санкт-Петербургской ассамблеи молодых
вычислительных систем. Фактически перечислен- ученых и специалистов (Компьютерные тех-
ный выше комплекс аппаратно-программных нологии, коммуникация, численные методы и
средств в сочетании с методикой его настройки на математическое моделирование). СПб.: Изд-во
прикладную задачу представляет собой вычисли- СПбГПУ, 2001. С. 24.
тельную платформу для создания ряда встроенных 5. Ковязин Р.Р. Проектирование проблемно-
систем. Данная вычислительная платформа обла- ориентированных языков для встроенных вы-
дает многими "степенями свободы" для адаптации числительных систем // Политехнический
под задачу. Эта гибкость представлена аппарат- симпозиум "Молодые ученые — промышлен-
ными средствами обработки (встроенные микро- ности Северо-Западного региона": Тезисы
контроллеры и ПЛИС), интерфейсами (модуль- докладов. СПб.: Изд-во СПбГПУ, 2002. С. 66.
ность установки интерфейсных адаптеров и широ- 6. Платунов А.Е. Архитектурные абстракции в
кая их номенклатура), настраиваемой системой технологии проектирования встроенных вы-
электропитания, развитым набором модульных числительных систем // Научно-технический
системных и инструментальных программных вестник СПбГИТМО(ТУ): Информационные,
средств. вычислительные и управляющие системы.

Развитием технологий создания подобного ро- СПб.: Изд-во СПбГИТМО(ТУ), 2002. Вып. 6.
да вычислительных систем для встроенных при- с. 76–83.
ложений активно занимается коллектив Лаборато-
рии микропроцессорной техники кафедры ВТ СПб
ГИТМО (ТУ) [6]. Поддержка в апробации резуль-
татов работы оказывается коллективами кафедры
материаловедения СПб ГИТМО (ТУ) и Лаборато- Санкт-Петербургский государственный институт
рии зондовой микроскопии ИАнП РАН. точной механики и оптики (Технический универси-

тет) (Голубок А.О., Платунов А.Е.)

СПИСОК ЛИТЕРАТУРЫ Институт аналитического приборостроения  РАН,
Санкт-Петербург (Сапожников И.Д.)

1. (http://embedded.ifmo.ru). Кафедра вычисли-
тельной техники СПбГИТМО (ТУ), сайт Ла- Материал поступил в редакцию 21.04.2003.
боратории микропроцессорной техники.

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3



СИСТЕМА  УПРАВЛЕНИЯ  СКАНИРУЮЩИМ  ЗОНДОВЫМ  МИКРОСКОПОМ 31

CONTROL  SYSTEM  FOR  A  SCANNING-PROBE  MICROSCOPE

A. O. Golubok, A. E. Platunov, I. D. Sapozhnikov*

Saint-Petersburg State Institute of Fine Mechanics and Optics (Technical University)
*Institute for Analytical Instrumentation of Russian Academy of Sciences, Saint-Petersburg

This paper describes a modern implementation of a control system for the scanning-probe microscope. The
core of the system is a high-performance programmable embedded controller based on the modules MEC5091
and ADEPT. A personal computer is used as a console for control, display, and  as  a data processing unit. A
programming system is available, so it is possible to define the control algorithm using the SPML language.

НАУЧНОЕ ПРИБОРОСТРОЕНИЕ, 2003, том 13, № 3