Труды ИСП РАН, том 33, вып. 4, 2021 г. // Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021 Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

Text documents marking algorithm based on interword distances 
shifting invariant to format conversion  

DOI: 10.15514/ISPRAS-2021-33(4)-10 1 A.V. Kozachok, ORCID: 0000-0002-6501-2008 <a.kozachok@academ.msk.rsnet.ru> 
1 S.A. Kopylov, ORCID: 0000-0003-2841-5243 <gremlin.kop@mail.ru> 

1 
Алгоритм маркирования текстовых документов P.N. Gorbachev, ORCID: 0000-0002-4511-0348 <pavel.gorbachev@list.ru> 

2 A.E.  Gaynov, ORCID: 0000-0003-3887-5374 <gae@mil.ru> 
на основе изменения интервалов между 2 B.V.  Kondrat’ev, ORCID: 0000-0003-0510-651X <gae@mil.ru> 

словами, обеспечивающий устойчивость  1 Academy of Federal Guard Service, 
35, Priborostroitel’naya st., Orel, 302015, Russia. 

к преобразованию формата 2 Ministry of Defence of the Russian Federation, 
19, Znamenka st., Moscow, 119160, Russia 

Abstract. The article presents an electronic text documents marking algorithm based on the identification 
1 А.В. Козачок, ORCID: 0000-0002-6501-2008<a.kozachok@academ.msk.rsnet.ru> information embedding by changing the values of the intervals between words (interwords distance shifting). 

1 С.А. Копылов, ORCID: 0000-0003-2841-5243 <gremlin.kop@mail.ru> The algorithm development is aimed at increasing the documents containing text information security from 
1 П.Н. Горбачев, ORCID: 0000-0002-4511-0348 <pavel.gorbachev@list.ru> leakage through the channel due to the transfer of documents printed on paper, as well as the corresponding 

2 А.Е. Гайнов, ORCID: 0000-0003-3887-5374 <gae@mil.ru> electronic copies of paper documents. In the marking algorithm developing process, an existing tools analysis 
2 Б.В. Кондратьев, ORCID: 0000-0003-0510-651X <gae@mil.ru> of protecting paper documents from leakage was carried out, practical solutions in the field of protecting text 

documents were considered, their advantages and disadvantages were determined. The interwods distance 
1 Академия Федеральной службы охраны Российской Федерации, shifting algorithm acts as an approach to the information embedding in electronic documents. Changing the 

302015, Россия, г. Орёл, ул. Приборостроительная, д. 35 values of interwords distance is based on embedding the normalized space in the selected areas of text lines 
2 Министерство обороны Российской Федерации, and adjusting the remaining values of the spacing between words by the calculated values. To invariance ensure 

119160, г. Москва, ул. Знаменка, д.19 of the embedded marker for printing and subsequent scanning or photographing, formation algorithms of 
embedding regions and embedding matrix have been developed. In the embedding regions forming process 

Аннотация. В статье представлен алгоритм маркирования электронных текстовых документов, from the text lines of the source document, arrays of spaces are formed, consisting of pairs: four and two spaces 
основанный на внедрении идентификационной информации за счет изменения величин интервалов or two spaces. By means of the embedded information in the formed areas, the places where the normalized 
между словами. Разработка алгоритма направлена на повышение защищенности документов, space is inserted is determined. In the embedding a marker process, an embedding matrix is formed, containing 
содержащих текстовую информацию, от утечки по каналу, обусловленному передачей напечатанных the values of the word displacement, and it is embedded in the original document in the process of printing. 
на бумаге документов, а также соответствующих электронных копий бумажных документов. В The developed marking algorithm usage makes it possible to introduce a marker into the electronic document 
процессе разработки алгоритма маркирования проведен анализ существующих средств защиты text structure that is invariant to the format transformation of an electronic document into a paper one and vice 
бумажных документов от утечки, рассмотрены практические решения в области защиты текстовых versa. In addition, the developed marking algorithm features and limitations are presented. Directions for 
документов, определены их достоинства и недостатки. В качестве подхода к внедрению информации further research identified. 
выступает алгоритм изменения величин интервалов между словами. Изменение величин интервалов 
между словами основано на встраивании удлиненного пробела в выделенные области строк текста и Keywords: information leakage protection; marking; pattern recognition; image processing; text documents 
корректировке остальных значений величин интервалов между словами на рассчитанные значения. Для For citation: Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents 
обеспечения инвариантности встроенного маркера к печати и последующему сканированию или marking algorithm based on interword distances shifting invariant to format conversion. Trudy ISP RAN/Proc. 
фотографированию разработаны алгоритмы формирования областей встраивания и матрицы ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 (in Russian). DOI: 10.15514/ISPRAS–2021–33(4)–10 
встраивания. В процессе формирования областей встраивания из строк текста исходного документа 
формируются массивы пробелов, состоящие из пар: по четыре и два пробела или по два пробела. 
Посредством встраиваемой информации в сформированных областях определятся места встраивания 1. Введение 
удлиненного пробела. В процессе встраивания маркера формируется матрица встраивания, содержащая Совершенствование средств защиты информации является одним из наиболее актуальных 
значения смещения слов, и осуществляется ее встраивание в исходный документ при печати. направлений развития подходов к обеспечению информационной безопасности. 
Применение разработанного алгоритма маркирования позволяет внедрять в структуру текста Стремительный переход всех сфер общественных отношений в информационное 
электронного документа маркер, инвариантный к преобразованию формата электронного документа в пространство позволил не только повысить степень автоматизации предоставляемых услуг и 
бумажный посредством печати и обратно через сканирование или фотографирование. Представлены 
особенности и ограничения разработанного алгоритма маркирования. Определены направления сервисов конечным пользователям, но и выявить существующие ограничения и дефекты, 
дальнейших исследований. присущие средствам защиты. 

Анализ инцидентов информационной безопасности, связанных с утечкой конфиденциальной 
Ключевые слова: защита от утечки информации; маркирование; распознавание образов; обработка информации и персональных данных показал, что за 2020 год в мире зарегистрировано 2395 
изображений; текстовые документы случаев утечки информации ограниченного доступа, при этом на Россию приходится 
Для цитирования: Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. примерно 17 процентов (404 случая утечки) от общего числа [1, 2]. По типу нарушителя 
Алгоритм маркирования текстовых документов на основе изменении интервала между словами, наибольшее число утечек осуществлено за счет действий внутренних нарушителей (79 %), 
обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, вып. 4, 2021 г., которые в большинстве случаев осуществлены умышлено. Наибольшее распространение 
стр. 131-146. DOI: 10.15514/ISPRAS–2021–33(4)–10 среди каналов утечки получили: сетевые (61%), службы мгновенных сообщений, 

131 132 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
2. Алгоритм маркирования текстовых документов на основе 

осуществляющих передачу текстовых, голосовых и видео сообщений (19,7%), а также канал 
утечки бумажных документов (15%). Реализация столь значительного числа нарушений изменения интервалов между словами 
информационной безопасности стала возможна ввиду ориентированности существующих В качестве предложенного подхода к маркированию электронных документов, содержащих 
средств защиты на противодействие вредоносным и противоправным действиям внешних текстовую информацию, в процессе печати выступает подход к внедрению информации в 
нарушителей. структуру и формат текста за счет горизонтального сдвига слова внутри строки [14]. 
Для защиты от утечек широкое распространение получили средства межсетевого Подход к маркированию электронных документов, основанный на изменении положения 
экранирования и системы предотвращения утечек информации (Data Loss/Leak Prevention, (горизонтального сдвига, изменения величины интервала между словами) слов внутри 
DLP-системы). Межсетевой экран (брандмауэр, firewall) – аппаратное и\или программное текстовых строк, используется в работах Хуанга (Ding Huang) и др. [15], Алаттара (Adnan M. 
средство, осуществляющее анализ, мониторинг и фильтрацию проходящего сетевого Alattar) и др. [16], Яна (Huijuan Yang) и др. [17]. 
трафика согласно установленных правил безопасности [3–5]. Применение методов В работе [15] в качестве электронного документа, в который осуществляется встраивание, 
блокировки и анализа передаваемого трафика на разных уровнях модели OSI средствами выступает электронное текстовое изображение (изображение, содержащее исходный 
межсетевого экранирования позволяет снизить количество утечек, осуществляемых по текстовый документ). Встраивание информации реализуется посредством изменения 
сетевым каналам, а также по каналам утечки, использующим службы мгновенных расстояния между словами и длин каждого слова таким образом, чтобы среднее расстояние 
сообщений, осуществляющих передачу текстовых, голосовых и видео сообщений. В то же между словами в каждой строке представляло собой синусоидальную волну определенной 
время указанные средства защиты не способны противодействовать утечкам фазы и частоты. К достоинствам предложенного подхода относятся: возможность извлечения 
конфиденциальной информации по каналу, обусловленному преобразованием формата встроенной информации только из подписанных изображений, стойкость к осуществлению 
электронного документа, содержащего текстовую информацию, в бумажный документ преобразования "печать-сканирование", фильтрация изображения и поворот на небольшие 
посредством печати и обратно – в цифровое изображение посредством сканирования углы. Существенным недостатком предложенной схемы маркирования является 
распечатанного документа. возможность внедрения информации только в тексты, выравненные по ширине, а также 
Для устранения указанного недостатка могут быть применены DLP-системы, требование по наличию информации о фазе и частоте синусоидальной волны на этапе 
осуществляющие идентификацию конфиденциальных данных, направляемых в другие сети, извлечения встроенной информации. 
находящиеся в распределенных репозиториях (банках данных), а также хранящихся у По аналогии с исследованием [16], в работе Алаттара [15] представлена схема маркирования 
конечного пользователя [6–9]. В зависимости от используемого метода защиты DLP-системы электронных текстовых документов за счет изменения величин интервалов между словами, 
могут быть разделены на: сигнатурные методы (технология цифровых отпечатков пальцев), позволяющая осуществлять извлечение встроенной информации, как из электронных 
методы поиска по словарю, а также методы маркирования. Применение технологии документов, так и из соответствующих им бумажных копий. В процессе встраивания 
цифровых отпечатков пальцев позволяет добиться высокой точности обнаружения в информации осуществляется увеличение или уменьшение величины интервала между 
исследуемом трафике конфиденциальной информации. К недостаткам данной технологии словами на установленное значение в зависимости от значения символа встраиваемой 
относится отсутствие стойкости сигнатуры (шаблона) к применению преобразований и последовательности. Предложенная схема позволяет повысить величину предельно 
внесению искажений (в том числе и преднамеренных), а также невозможность выделения достижимой емкости встраивания до 300 бит на страницу текста формата Letter. В свою 
(формирования) сигнатуры для некоторых типов данных. Кроме того, сигнатурные методы и очередь, процесс извлечения характеризуется наличием "пачек" ошибок (последовательно 
методы поиска по словарю накладывают на процесс обнаружения требование по созданию и идущих ошибок), что накладывает требование по использованию помехоустойчивых кодов, 
ведению актуальной базы сигнатур или шаблонов.  обладающих свойством перемежения. Применение подобных кодов, в свою очередь, снижает 
В отличие от технологии цифровых отпечатков пальцев, в процессе использования размер встраиваемой информации. 
технологии маркирования осуществляется встраивание маркера (идентификационной В отличие от исследований [15, 16], в работе [17] предложена схема изменения величин 
информации) в исходный документ [10]. Наличие встроенного маркера позволяет повысить интервалов между словами, основанная на измерении не только интервалов между словами, 
стойкость защищаемой информации к осуществлению различных преобразований и но и интервалов между символами на краях слов. В процессе внедрения осуществляется 
внесению искажений. Указанная особенность позволяет использовать методы маркирования детектирование смежных друг с другом слов, а также интервалов, как между словами, так и 
для повышения защищенности бумажных документов от утечки.  между соседними символами, находящихся на краях данных слов. Посредством полученных 
Анализ существующих решений в области маркирования документов, выводимых на печать, значений осуществляется увеличение или уменьшение интервала между словами на 
показал, что для защиты бумажных документов от утечки существуют следующие установленное значение. Разработанный алгоритм позволяет осуществлять встраивание и 
программные продукты Trace Doc [11], EveryTag [12] и SafeCopy [13]. Однако существенным извлечение встроенной информации из текстовых изображений и характеризуется высокой 
недостатком всех продуктов является необходимость создания защищенной базы данных, точностью извлечения. При этом в случае извлечения встроенной информации из 
содержащей или оригиналы электронных текстовых документов, подготовленных к печати, отсканированных или сфотографированных изображений возрастает количество ошибок, 
или их подписанные копии. Наличие указанного недостатка не позволяет предотвратить связанных с ошибочным детектированием положения краевых символов. Указанные ошибки 
утечку бумажного документа, не имеющего подписанного электронного оригинала. возникают из-за объединения соседних слов или слова и предлога воедино. 
Для устранения указанного недостатка и повышения защищенности бумажных документов, Проведенный анализ разработанных подходов к маркированию электронных документов, 
а также соответствующих электронных копий от утечки необходимо разработать алгоритм основанных на изменении интервалов межу словами, позволяет сделать вывод о наличии 
маркирования текстовых документов, подготовленных к печати, обеспечивающий ограничений в процессе защиты бумажных документов от утечки, обусловленной 
инвариантность встроенной информации к осуществлению преобразования формата и преобразованием формата бумажного документа в электронный вид посредством 
возможность извлечения встроенного маркера только из подписанного документа. применения операции "печать-сканирование" или "печать-фотографирование". В связи, с чем 

133 134 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
информации к визуальному анализу, а также емкостью встраивания достаточной для 

для повышения точности извлечения и невидимости встроенных данных предложена схема внедрения 50-200 бит информации. 
маркирования 4BLK + 2 . В качестве областей встраивания выступают последовательности Алгоритм маркирования электронных документов, содержащих текстовую информацию – 
из четырех или двух последовательно идущих пробелов. Встраивание информации электронных текстовых документов, подготовленных к печати, состоит из: 
осуществляется за счет изменения величины пробелов между словами следующим образом: 
последовательности из четырех пробелов соответствует два символа встраиваемой • преобразования формата электронного текстового документа в изображение; 
информации, двум пробелам – один символ. Применение данной схемы позволяет учесть • выделения строк текста из текстовых областей изображения; 
недостатки подходов маркирования, описанных в работах [15–16]. • выделения областей встраивания; 
Разработанный алгоритм маркирования электронных документов представлен на рис. 1.  

• кодирования встраиваемой информации; 
• формирования матрицы встраивания на основе закодированной информации и областей 

встраивания; 
• смещения областей изображение соответствующих словам в выделенных текстовых 

строках согласно рассчитанной матрице встраивания. 
На первом этапе (шаг 1 алгоритма маркирования) электронный текстовый документ DO  
подвергается конвертации формата в изображение Im . Под электронным текстовым 
документом в контексте работы понимается документ, содержащий сплошной текст, текст, 
разбитый на графы, а также другую текстовую информацию, представленную в электронной 
форме [18, 19]. 
На втором этапе (шаг 2 алгоритма маркирования) осуществляется формирование текстовых 
областей изображения и выделение строк текста Lines посредством функции TextDetection. 

2.1 Выделение строк текста в текстовых областях изображения 
Алгоритм выделения строк текста Lines, реализуемый функцией TextDetection, представлен 
на рис. 2. 

 
Рис. 1. Алгоритм маркирования текстовых электронных документов, основанный на изменении  

интервалов между словами Рис. 2. Функция выделение строк текста TextDetection 
Fig. 1. Electronic text document marking algorithm based on interword distances shifting Fig. 2. Text lines detection function TextDetection 

Применение указанного подхода позволяет осуществить перцептивно невидимое внедрение В процессе извлечения строк текста Lines из изображения функцией TextDetection 
информации, не внося изменений в структуру, семантику и синтаксис исходного документа. осуществляется детектирование текстовых областей. Из полученных текстовых областей 
Кроме того, алгоритмы данной группы характеризуются высокой невидимостью встроенной формируются текстовые последовательности, составляющие строки текста исходного 

135 136 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
изображения, что позволяет качественно отфильтровывать лишние шумы (рис. 3г, 3д). С 

документа DO . На шаге 1 осуществляется растеризация векторных элементов изображения теоретической точки зрения такая эвристика обоснована минимальным читаемым 
, при их наличии в соответствии с заданным разрешением печати.  разрешением, поскольку совокупность из 2-3 пикселей шума, оставшаяся после этапов 

Растеризованное изображение  подвергается процедуре нормализации изображения фильтрации изображения, не может представлять собой часть изображения пригодную для 
(шаги 2-8). В случае если ширина ℎ( ) превышает значение в 9920, то ℎ  интерпретации человеком в качестве символа.  
уменьшается до значения 9920, в случае если ℎ( ) меньше 1654, то ℎ  Рассчитанная система множеств, передается в процедуру DetectAreaLink, где с каждым 
увеличивается до этого значения. В результате нормализации формируется нормализованное элементом сопоставляются его базовые характеристики, включая центр области (центроид), 
растрированное изображение  (рис. 3а). Процедура нормализации разрешения, с одной высоту, ширину. Затем, для близких пар символов рассчитываться информация об их 
стороны, является оптимизацией, поскольку задачи детектирования текстовых областей не связанности, включая расстояние между ними, соотношение их сторон относительно друг 
требуют сверхвысокого разрешения изображения, но в то же время сложность таких методов друга. Текстовая область представляет собой совокупность связанных контуром отдельных 
растет нелинейно, и работа над высокодетализированным изображением приведёт к символов, принадлежащих одной прямой, проходящей через центр символьных контуров. 
взрывному росту вычислительной сложности. С другой стороны, ограничение возможного Для каждого символьного контура посредством функции DetectAreaLink рассчитывается его 
разрешения изображения некоторым диапазоном значений позволяет на последующих шагах центр (центроид), который соединяется с центрами соседних символьных контуров, 
заложить эвристики и фиксированные значения матриц, используемых в операциях над принадлежащих одной прямой линии (рис 3е). Символьные контуры, сформированные на 
изображением. шаге 15, представляют собой связанные области, из которых функцией DetectLines 

формируются строки текста RawLines (рис 3ж). На шагах 17-18 каждая текстовая строка 
разделяется на слова (рис. 3з). Полученный массив текстовых строк Lines представляет собой 
результат выполнения функции TextDetection, на основании которого формируются области 
встраивания и встраиваемая последовательность сдвигов слов в тексте. 

2.2 Формирование областей встраивания 
На третьем этапе (шаги 3-15 алгоритма маркирования) из массива строк текста Lines 
формируются области встраивания исходного документа	 . Область встраивания 
представляет собой систему множеств, элементы которой эквивалентны словам строки 

Рис. 3. Результаты выделения строк из изображения текста и, в свою очередь, состоят из наборов координат пикселей, образующих эти слова. 
Fig. 3. Lines detection results from image Предлагаемый алгоритм требует не менее трех слов в каждой кодируемой строке, поскольку 

Нормализованное изображение  подвергается фильтрации, включающую гауссовский крайние слова остаются на своих позициях для сохранения выравнивания текста и 
фильтра размытия (шаги 10-11) и операцию растягивания светлых областей (шаг 12). минимизации визуальных искажений. Таким образом, строки из одного-двух при 
Функция BlurGaussianFilter фильтрует изображение  гауссовским Фильтром встраивании метки остаются без изменений и игнорируются при её извлечении.  
размытия матрицей свертки 5×5  (рис 3б). Функция Dilate осуществляет растягивание В процессе коррекции искажений требуется выполнить сдвиг слов внутри строки, 
(расширение) светлых областей изображения , используя матрицу свертки 3×3  обеспечивающий изменение соотношения длин обрамляющих их пробелов, при 
(рис 3в). Фильтрация изображения позволяет снизить шум и повысить точность неизменности суммы всей совокупности, что создаёт особые требования к таковой операции. 
детектирования текстовых областей. Отфильтрованное изображение  подвергается Незначительное изменение пробелов между словами может оказаться недостаточным для их 

различия на этапе извлечения информации, в то же время использование чрезмерно длинных 
бинаризации – формированию черно-белого изображения  посредством функции пробелов, потребует равного их длине сокращения остальных. В свою очередь, указанная 
Binarization (рис. 3г). Совокупность такой последовательности трех операций так же особенность может привести к недостаточности длины пробела для разделения двух и более 
приводит к уменьшению различий между бинаризиноваными изображениями одного и того слов и на этапе детектирования, и они будут обнаружены как одно.  
же документа, полученных из разных источников. Фактическим результатом являются 
остовы текстовых символов, которые необходимо объединить в совокупности, Для решения этой проблемы была предложена схема кодирования " 4BLK + 2 ". В 
принадлежащие к одной строке, одному слову. соответствии с этой схемой пробелы в строке, начиная с самого первого последовательно 

объединяться в BLK (шаг 8) блоков  по четыре пробела в каждом (шаг 9). При наличии в 
Выделение множества смежных областей одного цвета в изображении  реализовано 
процедурой DetectConnectedAreas (шаг 14), путём поэтапного обхода всех пикселей строке остатка, из двух-трех пробелов, не вошедших в блоки , первая пара формирует 
изображения с маской отсечения для уже посещенных координат. На выходе формируется один блок . Для примера, строки из трех, четырех слов формирует BLK = 0 блоков  и 
система множеств, элементы которой соответствуют координатам пикселей, формирующих один
остовы символов. При этом, в силу особенностей языковой записи, шрифта и искажений 
изображения, некоторые символы могут распознаваться как последовательность из более чем [ блок , пять-шесть слов дают BLK = 1 блок  и ноль блоков  и так далее. 

Форма]л,ьные[ ] условия, которым должна удовлетворять формируемая совокупность 
, определены в строках 10-12. В такой схеме, для обычного текста имеется 

одной области, например, символы "ы", ";", "й". И наоборот, когда одной области могут существенное преобладание блоков типа , что позволяет формировать сдвиги с одним 
принадлежать последовательности из нескольких символов, к примеру, сливающиеся удлиненным (удлиняющимся) пробелом, при вычитании этого удлинения из трех 
декоративные элементы последовательности символов «ны» для шрифтов с засечками. В укорачивающихся. Подобный подход уменьшает ошибки в ходе детектирования текстовых 
процедуре DetectConnectedAreas реализована эвристика отбрасывания тех элементов областей с чрезмерно малыми пробелами, а также связывает схему кодирования с кодовой 
системы множеств, которые имеют слишком малую мощность для распознаваемого 

137 138 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
Дл

структурой с четным числом блоков, снижая вероятность влияния ошибок вставки или 
выпадения одиночного пробела в строке. ,я	  формирования маркера E исходная информация L кодируется в двоичную систему 

счисления, при этом под каждый компонент L отводится определенное число бит:  – 14 бит, 
– 4 бита,  – 14 бит. Полученная последовательность кодируется кодом Рида-Соломона 

В результате на третьем этапе алгоритма маркирования для каждой строки текста l и передается на этап формирования встраиваемой последовательности. 
формируется область встраивания – массив значений, состоящий из следующих элементов: 
• [ ] – последовательность интервалов между словами (пробелов); 
• [ ], [ ] 2.4 Формирование матрицы встраивания 

 – область встраивания, состоящая из последовательностей по 4 или 2 
пробела; 

• [ ] На пятом этапе (шаги 17-38 алгоритма маркирования) посредством закодированной 
информации E и областей встраивания ( [ ], [ ], [ ] , [ ]) осуществляется 

 – значение удлиненного пробела. формирование матрицы встраивания MLines, содержащей позиции интервалов между 
На четвертом этапе (шаг 16 алгоритма маркирования) осуществляется помехоустойчивое слова[м]и,  и с[оо]тветствующие значениям в пикселях. Для формирования последовательности 
кодирование встраиваемой информации L в качестве маркера E. Использование MLines осуществляется последовательное считывание элементов областей встраивания 
помехоустойчивого кода позволяет компенсировать ошибки, возникающие в результате . Для блока из четырех пробелов [ ] из закодированной 
искажений маркируемого документа: в результате его подписи, добавления в отпечатанный последовательности E извлекается очередная пара бит, определяющая номер нормального 
документ печатей, утраты его части или ошибок в работе детектора текста. про(бе,л| а| , ( [ ] ,|в |блок [е ] [ ]. В зависимости от последовательно считанных символов 

 формируется следующим образом: 
2.3 Особенности формирования встраиваемого маркера • если два первых символа последовательности E имеют значение (0,0), то первый пробел 
В качестве встраиваемой информации L может выступать следующая информация: в последовательности [ ] заменяется на нормированный пробел [ ] строки l, 

остал[ьн]ы	 е элементы [ ] остаются неизменными; 
• идентификатор пользователя ; 

• если два первых символа последовательности E имеют значение (0,1), то значение 
• метка конфиденциальности документа ; присваивается второму элементу, при этом остальные элементы [ ] остаются 
• метка, содержащая информацию о времени встраивания ; без изменений; 
• идентификатор средства вычислительной техники ; • если
• информация о целостности документа . 
Встраиваемая метка зависит структуры и размера встраиваемой информации L. Исходя из [ []дв]	а первых символа последовательности E имеют значение (1,0), то значение 

присваивается третьему элементу, при неизменности остальных элементов 
; 

цели разработанного алгоритма маркирования – повышение защищенности • в остальных случаях – только четвертый элемент [ ] заменяется на [ ]; 
конфиденциальной информации и персональных данных от утечек по каналу утечкой • после любой из замен осуществляется переход к следующему символу кодовой 
бумажных документов, структура встраиваемой информации L имеет вид: = , , . последовательности E. 
Размер встраиваемой метки зависит от емкости встраивания электронного документа  и не Для блоков из двух бит [ ] матрицы встраивания [ ], [ ] , в зависимости от 
может превышать величину предельно достижимой емкости встраивания. Под емкостью символа ( ,| |, пробел [ ] подставляется следующим образом: 
встраивания понимается то количество информации, которое может быть встроено в 
электронный документ выбранным подходом к внедрению информации. Для электронного • если символ последовательности E имеет значение (0), то значение [ ]присваивается 
текстового документа  величина предельно равна значению | [ ]	|, ∀ ∈ 1…  и первому элементу, при этом второй элемент [ ] не изменяется; 
определяется количеством интервалов между словами (числом пробелов) в тексте. • в противном случае – второй элемент [ ] заменяется на [ ], при отсутствии 
Исходя из особенностей электронных документов, которые могут быть заполнены текстом изменений в первом; 
полностью, наполовину или могут содержать всего несколько строк текста, целесообразно • после любой из замен осуществляется переход к следующему символу кодовой 
ограничить размер встраиваемого маркера 48 битами. Учитывая тот факт, что в последовательности E. 
разработанном алгоритме маркирования для внедрения 1 бита информации необходимо два Стоит отметить, что в случае наложения сформированной матрицы встраивания на исходный 
интервала между словами, то для внедрения 48 бит информации требуется не менее 96 текст без осуществления компенсации остальных пробелов в строке возможно появление 
интервалов между словами (пробелов) в тексте и соответствует документу, содержащему артефактов вида: выход строки текста за поля, искажение структуры текста, сдвиг знаков 
порядка 100-120 слов. пунктуации и прочие изменения в структуре исходного текста.  
Для обеспечения стойкости встраиваемого маркера к осуществлению преобразования Наличие указанных искажений делает встроенный маркер заметным для визуального анализа 
формата электронного текстового документа в бумажный вид, а также повышения точности и нарушает структуру текста. Для устранения указанного недостатка используется процедура 
извлечения встроенного маркера на шаге 16 алгоритма маркирования происходит компенсации пробелов в строке. На шагах 35-37 для каждой строки рассчитываются размеры 
помехоустойчивое кодирование встраиваемой информации L кодом Рида-Соломона. всех остальных пробелов [ ]. Перерасчет размеров пробела позволяет добиться того, что 
Применение указанного кода к последовательности маркера E размером 48 бит снижает все нормированные пробелы приняли одинаковое значение, а сумма всех пробелов в строке 
информационную часть до значения в 32 бита, остальные 16 бит приходятся на проверочную остал[а]с,ь неи[з]менной относительно исходного документа. 
часть. Полученные значения пробелов [ ] и массив значений пробелов областей встраивания 

 представляют собой матрицу встраивания . Полученная матрица 
139 140 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
изображения  и извлеченного на предыдущих этапах массива строк текста 

используется на этапе встраивания встраиваемой информации в величины интервалов между 	посредством функции LinkedForegroundObjects выделяется массив строк ′, 
словами функцией ChangeSpaces. содержащий объекты, не соотнесенные со строками . Этот шаг позволяет соотнести со 

словами любые элементы изображения, которые на этапах детектирования текстовых 
2.5 Внедрение матрицы встраивания в текстовые области исходного областей могли быть отфильтрованы в качестве шума, и обеспечивает минимизацию 

электронного документа визуальных искажений при изменении местоположения слов. 
На заключительном этапе алгоритма маркирования осуществляется внедрение встраиваемой После этого на шаге 3 рассчитывается фоновое изображение, т.е. исходное множество 
информации в электронный текстовый документ посредством изменения величин пикселей  приводится к такому виду, что значение цвета для всякого элемента множество 
интервалов между словами (значений пробелов) исходного текстового документа . При , входящего в состав одного из подмножеств ′, замещается усреднением цвета 
этом все пробелы в тексте электронного документа заменяются по следующему правилу: ближайших к нему по матрице смежности элементов  не принадлежащих какому либо 
• пробелы в строке , соответствующие позициям нормального пробела [ ] в областям 

встраивания [ ], [ ] подмножеству ′. Для каждой строки 	из маски встраивания  выделяются 
, заменяются на значение равное [ ]; значения ,  и .  и  формируют маску встраивания строки  (шаг 8). Функция 

• значение остальных пробелов строки l корректируются (уменьшаются или CalcSpaceInLine вычисляет значения величин интервалов между словами в массиве строк 
увеличиваются) до значения равного [ ].  (шаг 9). Исходя из полученных значений областей встраивания, на шагах 11-19 

осуществляется расчет величин интервалов между словами для каждой строки текста с 
Изменение величин пробелов сформированной матрицы встраивания осуществляет функция учетом сформированной матрицы встраивания следующим образом: 
ChangeSpaces, представленная на рис. 4. 

• если в последовательности  имеются еще не рассчитанные значения, то значениям 
интервалов между словами (пробелов) присваивается значение [ ] (шаги 13-14); 

• начиная со второго и заканчивая предпоследним словом в строке, осуществляется 
расчет смещения относительно исходной позиции слова cur, полученный результат 
округляется до целого функцией Round (шаги 15-20). В результате округления для 
каждой строки текста формируется массив смещений ; 

• во всех остальных случаях формируется нулевое смещение, что соответствуют 
формированию немаркированного документа	 . 

Из сформированного массива смещений и рассчитанной посредством функции 
GetWordPixelMask маски слов всех строк текста формируется маска заполнения, 
содержащая координаты формирующих слово пикселей и соответствующие им смещения. 
Кроме того, вычисляется наименьшее значение массива смещения  и наибольшее 

 (шаги 22 и 23 соответственно). 
Для осуществления внедрения матрицы встраивания в текстовые области исходного 
электронного документа реализуется процедура морфологического изменения границы 
посредством использования ядра фильтра, кратного размеру изображения (шаги 25-30). 
После чего изображение заполняется значениями пикселей с координатами, сдвинутыми на 
рассчитанное значение смещения (шаг 31), включая нулевые смещения для первых и 
последних слов строк. В результате работы алгоритма маркирования формируется 
подписанный документ , подготовленный к печати, т.е. документ, содержащий 
встраиваемую информацию  (маркер). 
Предлагаемый на шагах 20-31 подход не только реализует разработанный алгоритм, но и 
обеспечивает оптимизацию, связанную с внедрением специальных переменных , 

, , позволяющих сгруппировать операции сдвига на идентичные значения, 
что актуально в виду их дискретности. Такая оптимизация уменьшает число дорогостоящих 

 операций морфологического искажения (шаг 29), извлечения координат по маске (шаг 30), а 
Рис. 4. Функция изменения величин между словами ChangeSpaces также локализует операции доступа к памяти (шаг 31), увеличивая вероятность попадания в 

Fig. 4. Interword distances shifting function ChangeSpaces процессорные кэши. 
В начале процесса внедрения матрицы встраивания проводится этап дополнительного Разработанный алгоритм маркирования, основанный на изменении величин интервалов 
детектирования шумов, на котором все объекты, не соотнесенные со строками детектором между словами, позволяет осуществлять внедрение идентификационной информации в 
текста, связываются с ближайшим словом и включаются в его состав. На шаге 1 исходный различные документы, содержащие текстовую информацию и подготовленные к печати. 
текстовый документ  конвертируется в изображение и растеризуется. Из растеризованного Стоит отметить, что, как и любой алгоритм маркирования, разработанный алгоритм имеет 

некоторые особенности. 
141 142 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
разработка дополнительных этапов процесса извлечения, направленных на снижение 

3. Особенности разработанного алгоритма маркирования  влияния процесса сканирования (фотографирования) на точность извлечения встроенной 
Отличительная особенность разработанного алгоритма маркирования состоит в том, что информации, а также экспериментальная оценка основных параметров алгоритма 
алгоритм может быть применим только к документам, содержащим текст или текст, маркирования и сравнение полученных результатов с существующими аналогами является 
разбитый на графы, а также другую текстовую информацию. Помимо описанной, направлением дальнейших исследований. 
разработанный алгоритм характеризуется следующими особенностями [20, 21]: 
• наличие стойкости встроенного маркера к осуществлению печати документа, а также Список литературы / References 

применения операции сканирования или фотографирования к полученному бумажному [1]. Россия: утечки информации ограниченного доступа, 2020 год. InfoWatch. 2021, 30 стр. / Russia: 
документу; Restricted Information Leaks, 2020. InfoWatch. 2021, 30 p. Available at: https://www.infowatch.ru/ 

• возможность маркирования любого используемого формата документа (.doc, analytics/analitika/rossiya-utechki-informatsii-ogranichennogo-dostupa-2020-god, accessed 10.08.2021 
(in Russian). 

docx, .odt, .pdf, .png, .jpg, и др.), а также отсутствие зависимости процесса внедрения от [2]. Исследование утечек информации ограниченного доступа в 2020 году. InfoWatch. 2021, 40 стр. / 
используемого текстового редактора (при работе с текстовыми документами); Research on restricted information leaks in 2020. InfoWatch. 2021, 40 p. Available at: https:// 

• высокой емкостью встраивания информации, т. к. для встраивания 1 бита информации www.infowatch.ru/analytics/analitika/issledovanie-utechek-informatsii-ogranichennogo-dostupa-v-2020 
требуется только 2 интервала между словами (пробела) или 3 слова; -godu, accessed 10.08.2021 (in Russian). 

[3]. Mukkamala P. P., Rajendran S. A survey on the different firewall technologies, International Journal of 
• отсутствие стойкости встроенного маркера к применению средств оптического Engineering Applied Sciences and Technology, vol. 5, issue 1, 2020, pp 363-365. 

распознавания символов. [4]. Neupane K., Haddad R., Chen L. Next Generation Firewall for Network Security: A Survey. In Proc. of 
Кроме рассмотренных особенностей необходимо описать процесс излечения из бумажных the SoutheastCon 2018, 2018, pp. 1-6.  
документов встроенной информации. Извлечение встроенной информации реализуется [5]. Sharma R. K., Kalita H. K., Issac B. Different firewall techniques: A survey. In Proc. of the Fifth 
аналогичным образом, что и встраивание. Стоит отметить, что извлечение встроенной International Conference on Computing, Communications and Networking Technologies (ICCCNT). 
информации реализовано для цифровых изображений, полученных посредством 2014, pp. 1-6.  
сканирования или фотографирования бумажных документов. [6]. Lopez G., Richardson N., Carvajal J. Methodology for Data Loss Prevention Technology Evaluation for 

Protecting Sensitive Information. Revista Politécnica, vol. 36, no. 3, 2015, pp. 60-69. 
При этом применение указанных операций имеет следующие особенности: [7]. Alneyadi S., Sithirasenan E., Muthukkumarasamy V. A survey on data leakage prevention systems. 
• процесс сканирования характеризуется внесением в конечное изображение таких Journal of Network and Computer Applications, vol. 62, 2016, pp. 137-152.  

искажений как геометрические преобразования (поворот, масштабирование, сдвиг, [8]. Jadhav P., Chawan P. M. Data Leak Prevention system: A Survey. International Research Journal of 
обрезка и др.) и шумы сканера (дополнительные пиксели или области изображения, не Engineering and Technology, vol. 6, no. 10, 2019, pp. 197-199.  

[9]. Kozachok A.V., Kopylov S.A. et al. Text marking approach for data leakage prevention. Journal of 
присутствовавшие в бумажном документе); Computer Virology and Hacking Techniques, vol. 15. no. 3, 2019, pp. 219-232. 

• процесс фотографирования помимо внесения геометрических искажений в трех [10]. Козачок А.В., Кпылов С.А. и др. Подход к извлечению робастного водяного знака из изображений, 
плоскостях (поворот, отклонение и наклон камеры) характеризуется различными содержащих текст. Труды СПИИРАН, вып. 5(60), 2018 г., стр. 128-155 / Kozachok A.V., Kopylov 
видами искажений, вносимых объективом фотоаппаратуры и условиями съемки S.A. et al. An Approach to a Robust Watermark Extraction from Images Containing Text. SPIIRAS 
(дисторсия, прогрессирующее снижение освещенности, хроматические аберрации, муар Proceedings, issue 5(60), 2018, pp. 128-155 (in Russian). 
и прочие). [11]. Trace Doc. Available at: https://secretgroup.ru/trace-doc, Accessed 10.08.2021. 

[12]. Unique Interface. EveryTag. Available at: https://everytag.ru/ui, Accessed 10.08.2021. 
Наличие этапа предварительной обработки в процессе выделения строк текста, реализуемого [13]. Safe Copy. Available at: https://www.niisokb.ru/products/safecopy, Accessed 10.08.2021. 
функцией TextDetection, позволяет устранить лишь некоторые из представленных [14]. Jalil Z., Mirza A.M. A Review of Digital Watermarking Techniques for Text Documents. In Proc. of the 
искажений. Для устранения указанного недостатка необходимо разработать алгоритм International Conference on Information and Multimedia Technology, 2009, pp. 230-234.  
извлечения встроенной информации из изображений соответствующим бумажным [15]. Huang D., Yan H. Interword distance changes represented by sine waves for watermarking text images, 
документам. Разработка алгоритма извлечения встроенной информации позволит IEEE Transactions on Circuits and Systems for Video Technology, vol. 11, no. 12, 2001, pp. 1237-1245.  
осуществить количественную оценку точности извлечения, устойчивости встроенного [16]. Alattar A.M., Alattar O.M. Watermarking electronic text documents containing justified paragraphs and 
маркера к осуществлению преобразований и внесению искажений и осуществить irregular line spacing, In Proc. of the Conference on Security, Steganography, and Watermarking of 
сравнительный анализ полученных результатов с аналогами. Multimedia Contents, 2004, pp. 685-695.  

[17]. Yang H., Kot A.C. Text document authentication by integrating inter character and word spaces 
watermarking, In Proc. of the IEEE International Conference on Multimedia and Expo (ICME), 2004, pp. 

4. Заключение 955-958.  
Предложенный подход к маркированию электронных документов, выводимых на печать, [18]. Национальный стандарт Российской Федерации. Система стандартов по информации, 
позволяет повысить защищенность бумажных документов, содержащих конфиденциальную библиотечному и издательскому делу. Делопроизводство и архивное дело. Термины и 

определения, ГОСТ Р 7.0.8–2013, Стандартинформ, 2013 г., 16 с. / National standard of the Russian 
информацию, а также персональные данные, в случае неконтролируемого распространения Federation. System of standards on information, librarianship and publishing. Records management and 
или передачи документов лицам, не имеющим к ним легитимного доступа. Кроме того, organization of archives. Terms and difinitions, GOST R 7.0.8–2013, Standartinform, 2013, 16 p. (in 
наличие встроенной информации позволяет однозначно установить факт утечки, а также Russian). 
идентифицировать нарушителя. Разработанный алгоритм может применяться в DLP- [19]. Национальный стандарт Российской Федерации. Единая система конструкторской документации. 
системах и системах расследования инцидента информационной безопасности. При этом Общие требования к текстовым документам, ГОСТ Р 2.105–2019, Стандартинформ, 2019 г., 35 с. / 

143 144 



Козачок А.В., Копылов С.А., Горбачев П.Н., Гайнов А.Е., Кондратьев Б.В. Алгоритм маркирования текстовых документов на Kozachok A.V., Kopylov S.A., Gorbachev P.N., Gaynov A.E., Kondrat’ev B.V. Text documents marking algorithm based on interword 
основе изменении интервала между словами, обеспечивающий устойчивость к преобразованию формата. Труды ИСП РАН, том 33, distances shifting invariant to format conversion. Trudy ISP RAN/Proc. ISP RAS, vol. 33, issue 4, 2021. pp. 131-146 

вып. 4, 2021 г., стр. 131-146 
Boris Vladimirovich KONDRAT’EV is an employer of the Ministry of Defence of the Russian 

National standard of the Russian Federation. Unified system for design documentation. General 
requirements for textual documents, GOST R 2.105–2019, Standartinform, 2019, 35 p. (in Russian). Federation. Research interests: information security, protection against information leakages 

[20]. Библиотека маркирования текстовых документов при печати за счет горизонтального смещения through technical channels, software certification in accordance with information security 
слов, Свидетельство о государственной регистрации программ для ЭВМ № 2020667592 от requirements, information hiding methods. 
24.12.2020, Россия, заявка № 2020666902 от 17.12.12020 / Library for marking text documents when 
printing due to horizontal displacement of words, Certificate of state registration of computer programs 
№ 2020667592 dated 12.24.2020, Russia, application № 2020666902 dated 17.12.12020 (in Russian). 

[21]. Модуль маркирования текстовых документов при печати для ОС семейства Windows, 
Свидетельство о государственной регистрации программ для ЭВМ № 2020667579 от 24.12.2020, 
Россия, заявка № 2020666721 от 17.12.12020 / Module for marking text documents when printing for 
Windows family OS, Certificate of state registration of computer programs № 2020667579 dated 
12.24.2020, Russia, application № 2020666721 dated 12.17.12020 (in Russian). 

Информация об авторах / Information about authors 
Александр Васильевич КОЗАЧОК – доктор технических наук, доцент, сотрудник Академии 
Федеральной службы охраны Российской Федерации. Его научные интересы включают: 
информационная безопасность, защита от несанкционированного доступа, математическая 
криптография, теоретические проблемы информатики. 
Alexander Vasilievich KOZACHOK – Doctor of Technical Sciences, Associated Professor. 
Employer of the Academy of Federal Guard Service. His research interests include: information 
security, unauthorized access protection, mathematical cryptography and theoretical problems of 
computer science 
Сергей Александрович КОПЫЛОВ является сотрудником Академии Федеральной службы 
охраны Российской Федерации. Его научные интересы включают: методы машинного 
обучения, обработка цифровых изображений, текстовая стеганография. 
Sergey Alexandrovich KOPYLOV is an employer of the Academy of Federal Guard Service. His 
research interests include machine learning methods, digital image processing, text steganography. 
Павел Николаевич ГОРБАЧЕВ является сотрудником Академии Федеральной службы 
охраны Российской Федерации. Его научные интересы включают: информационная 
безопасность, методы машинного обучения, распознавание образов, текстовая 
стеганография, обработка изображений. 
Pavel Nikolaevich GORBACHEV is an employer of the Academy of Federal Guard Service. His 
research interests include: information security, machine learning methods, pattern recognition text 
steganography and image processing.  
Артур Евгеньевич ГАЙНОВ является сотрудником Министерства обороны Российской 
Федерации. Сфера научных интересов: безопасность информации, защита информации от 
несанкционированного доступа, построение информационных систем в защищённом 
исполнении. 
Artur Evgenevich GAYNOV is an employer of the Ministry of Defence of the Russian Federation. 
Research interests: information security, information unauthorized access protection, information 
systems construction in a secure design. 
Борис Владимирович КОНДРАТЬЕВ является сотрудником Министерства обороны 
Российской Федерации. Сфера научных интересов: информационная безопасность, защита 
информации от утечки по техническим каналам, сертификация программного обеспечения 
по требованиям безопасности информации, методы сокрытия информации. 

145 146