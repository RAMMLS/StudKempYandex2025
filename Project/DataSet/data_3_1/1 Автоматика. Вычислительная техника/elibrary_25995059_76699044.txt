Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

АЛГОРИТМ ПОЭТАПНОГО УТОЧНЕНИЯ ПРОЕКТИВНОГО ПРЕОБРАЗОВАНИЯ  
ДЛЯ СОВМЕЩЕНИЯ ИЗОБРАЖЕНИЙ 

А.И. Ефимов 1, А.И. Новиков 1 
1 Рязанский государственный радиотехнический университет (РГРТУ), Рязань, Россия 

Аннотация 
Приведён алгоритм поэтапного построения проективного преобразования по наборам 

пар ключевых точек, содержащих произвольное число таких точек (более 4 пар точек). В 
процессе вычисления матрицы гомографии производится обнаружение и отбраковка не-
удачных пар точек. Приведены экспериментальные результаты совмещения изображений с 
помощью проективных преобразований как для однородных, так и для разнородных изоб-
ражений. Предложены методы оценки качества совмещения изображений, обеспечивающие 
получение локальных и интегральных оценок качества совмещения. 

Ключевые слова: разноспектральные изображения, методы контурного анализа, клю-
чевые точки, проективные преобразования, матрица гомографии, совмещение изобра-
жений, качество совмещения. 

Цитирование: Ефимов, А.И. Алгоритм поэтапного уточнения проективного преобразова-
ния для совмещения изображений / А.И. Ефимов, А.И. Новиков // Компьютерная оптика. – 
2016. – Т. 40, № 2. – С. 258-265. – DOI: 10.18287/2412-6179-2016-40-2-258-265. 

Введение держат проективные искажения. Они описываются 
Жёсткие ограничения, налагаемые на время обра- дробно-линейными функциями, содержащими в об-

ботки разноспектральных изображений в авиацион- щем случае 8 неизвестных параметров (в случае 
ных системах технического зрения (СТЗ), вынуждают плоской гомографии) [3].  
искать быстрые алгоритмы решения задач в таких си- Проблема оценивания параметров проективного 
стемах. Одной из наиболее сложных в комплексе за- преобразования по опорным (ключевым) элементам 
дач, решаемых в бортовом вычислителе, является за- рассматривалась многими авторами, в частности, в 
дача совмещения пары в общем случае разнородных работах [4, 5]. В [4] предложена двухэтапная проце-
изображений (телевизионное или тепловизионное, с дура формирования пространственного преобразова-
одной стороны, и виртуальное изображение, постро- ния для совмещения изображений. В данной статье 
енное по цифровой карте местности, с другой). Кор- рассматривается аналогичная задача, для решения ко-
реляционные методы совмещения дают, как правило, торой предлагается альтернативный алгоритм по-
гарантированный результат [1]. Однако из-за ошибок этапного уточнения проективного преобразования. 
в навигационных параметрах летательного аппарата Поиск ключевых точек является наиболее важной 
для получения этого результата требуется выполнить задачей в методе совмещения изображений с помо-
построение около 106 виртуальных изображений под щью проективного преобразования. Далеко не всегда 
различными ракурсами, осуществить совмещение удается найти такие точки в автоматическом режиме. 
каждого из этих изображений с реальным изображе- Технология получения множества пар ключевых то-
нием и получить оценку критериальной функции. Та- чек в автоматическом режиме представлена в работе 
кой подход требует недопустимо больших затрат ма- [6]. Но если даже найдено некоторое множество пар 
шинного времени, исключающих применение мето- ключевых точек, то остаётся вопрос об их оптималь-
дов этой группы в реальных СТЗ.  ном использовании. Неудачный выбор ключевых то-
Использование методов контурного анализа для чек может приводить к плохому и даже очень плохо-

компактного описания наблюдаемой сцены [2] и ме- му качеству совмещения изображений. Один из ши-
тодов проективной геометрии [3] для совмещения па- роко применяемых методов автоматического выбора 
ры изображений является обнадёживающей альтер- корректного набора точек – метод RANSAC [7]. 
нативой корреляционным методам совмещения. Ос- 1. Технология и алгоритмы обработки 
новные шаги такой технологии таковы: изображений 

- выделение контуров объектов на реальном изоб-
ражении; Для учета проективных искажений можно исполь-

- аппроксимация контуров на реальном и вирту- зовать дробно-линейные преобразования [3]: 
альном изображениях многоугольниками;  h11x′ + h12 y′ + h13

- выбор угловых точек многоугольников в каче-  x =
 h31x′ + h32 y′ +1

стве ключевых и установление соответствия между ,
  (1) 

ними;  h21x′ + h22 y′ + h
y = 23

- построение проективного преобразования и сов-  h31x′ + h32 y′ +1
мещение изображений; 

- оценка качества совмещения.  или в матричной форме в однородных координатах 
Предметом обсуждения в настоящей работе явля- λx   h11 h12 h13   x′ 

ются последние два этапа описанной технологии. λy  = h21 h22 h 
23  ⋅  y′    . (2) 

Изображения, получаемые на борту воздушного суд-
на от разноспектральных датчиков, как правило, со-  λ  h   

   31 h32 1   1 

258 Компьютерная оптика, 2016, том 40, №2 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

Матрица гомографии H = (hij)3×3 в составе формулы показывают исследования, даже применение алго-
(1) содержит 8 неизвестных параметров, для нахожде- ритма RANSAC для решения этой задачи не всегда 
ния которых необходимо как минимум 4 пары ключе- обеспечивает получение хорошего результата [8]. По-
вых точек на сопоставляемых изображениях. Форми- этому естественным представляется желание исполь-
рование множества пар ключевых точек, с одной сто- зовать всё множество пар ключевых точек для поиска 
роны, и выбор из этого множества оптимального набо- матрицы гомографии. Однако в этом множестве мо-
ра точек, обеспечивающих корректное определение гут быть пары либо с ложным соответствием, либо 
элементов матрицы гомографии, с другой стороны, – пары, в составе которых координаты одной точки в 
две основные задачи в проблеме совмещения изобра- паре определены недостаточно точно. В этом случае 
жений с помощью матрицы гомографии. предлагается использовать процедуру поэтапного 
Для решения первой задачи предложено большое уточнения матрицы гомографии, а именно: 

число методов (SURF, SIFT [9, 10], методы, основан- – находить матрицу гомографии по всему множе-
ные на идеях контурного анализа [6]). Первые два ме- ству пар ключевых точек и выполнять совмещение 
тода (SURF, SIFT) дают хорошие результаты при по- изображений; 
иске ключевых точек на паре изображений, получен- – оценивать качество совмещения изображений. 
ных с помощью однотипных датчиков, и неприемле- Если совмещение неудовлетворительное, то находить 
мы для сопоставления разнородных изображений, пару (пары) ключевых точек, расстояние между обра-
особенно если последние представлены контурами зами которых оказалось наибольшим, и удалять их из 
основных объектов на подстилающей поверхности. множества пар ключевых точек; 
Именно такие изображения приходится сопоставлять – вновь находить матрицу гомографии по сокра-
в авиационных СТЗ. Для поиска ключевых точек на щённому множеству пар ключевых точек, выполнять 
контурных изображениях в [6] предложены методы, совмещение изображений, оценивать качество сов-
дающие достаточно хорошие результаты. мещения и, возможно, удалять некоторые пары клю-
Для каждой пары ключевых точек X T

i = (xi, yi)  и чевых точек и т.д., пока не будет получено удовле-
X ′ = ( x′

i i , y′)T
i , i = 1, k  в соответствии с формулами творительное совмещение изображений. 

(1) можно составить пару уравнений  Описанная технология поиска матрицы гомогра-
фии, обеспечивающей наилучшее совмещение изоб-

 xi xi′h31 + xi yi′h32 + xi = xi′h11 + yi′h12 + h13 , ражений по имеющемуся множеству пар ключевых 
  (3) 
yi xi′h31 + yi yi′h32 + yi = xi′h21 + yi′h22 + h23 . точек, предполагает изменение алгоритма нахожде-

ния элементов матрицы гомографии. Если мы ис-
Система линейных алгебраических уравнений 

( пользуем все k пар ключевых точек, то система (4) 
СЛАУ) вида (3), преобразованная к стандартной 

будет состоять из 2k уравнений. Её решение с помо-
форме записи СЛАУ, имеет следующий вид 

щью любого численного алгоритма, не обладающего 
AGH = B , (4) вычислительной устойчивостью (метод Гаусса и др.), 

где A – основная матрица системы, может приводить к ошибочным результатам. Поэтому 
G от СЛАУ вида (4) целесообразно перейти к нормаль-

H = (h h h h h h h h )T – вектор-
11 12 13 21 22 23 31 32

ной СЛАУ: 
столбец подлежащих определению элементов матрицы 
гомографии, B = (x1 x2 x3 x4 y1 y2 y3 y4 )T – ( AT A)G T

H = A B . (5) 
вектор-столбец координат ключевых точек первого Решать СЛАУ (5) целесообразно любым методом, 
изображения, записанных в указанном порядке. Матри- предназначенным для решения систем с симметрич-
цу A и вектор-столбец B в составе (4) можно записать в ной и положительно определённой основной матри-

 Z O W1   B  цей (например, метод квадратного корня [11]).  
блочной форме A =  , B = 1

 . Здесь  
Переход от системы (4) к нормальной СЛАУ (5) 

O Z W 
2  B 

2 
эквивалентен поиску преобразования H, минимизи-

 x′ ′
1 y1 1 рующего сумму квадратов уклонений образов HX′ то-

 ′  чек X′от соответствующих им точек X, т.е. 
Z = 

x2 y′
2 1 , O = (0) ,  

 x′ y′  3×3
3 3 1 k 

 xi − φ (x , ′, ′
i xi y ) + 

 F
 ′ ′ 

x  (G
4 y4 1 H ) ( )2

= 1
∑  → min,  

= 
+ ( y − φ2 (y , x′, y′))2

1  h
i ij

i i i 
 −x ′ ′

1x1 −x y  − y ′ − ′
1 1  1x1 y1 y1 

  где φ1 = x′
ih11 + y′

ih12 + h13 − xi x′
ih31 − xi y′

ih32 , 
−x ′ ′ 

2 x2 −x y′ 
W = 2 2  y x y y

1 , W = 
− 2 2 − ′

2 2   φ
−x ′ 2 .
  2 = x′

ih21 + y′
ih22 + h23 − y ′

i xih31 + yi y′
ih32 . 

3x3 −x y′  − y ′
3x3 −y y′ 

3 3 3 3
 В рамках стандартного метода наименьших квад-
  

r  
−x4 x −x4 y′ 

4 4  − y ′
4 x4 −y ′

4 y4  ратов из необходимого условия минимума 
СЛАУ (4) будет иметь единственное решение, ес- [(∂F(GH))/(∂GH)] = 0 функции F(GH) получаем систему 

ли ранг её основной матрицы равен 8. уравнений (5). 
Выбор из множества k(k>>4) пар ключевых точек Тогда СЛАУ (5) можно переписать в равносиль-

четырёх наилучших является непростой задачей. Как ной форме 

Компьютерная оптика, 2016, том 40, №2 259 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

 Z T Z O Z TW  рианте находились в результате решения СЛАУ (4). 
1

 На рис. 2 приведено лучшее из 3060 совмещений кон-
O Z T Z Z T 

 W2  ⋅GH =  
туров, найденное с помощью соответствующей мат-

W T
 Z W T Z W TW +W TW 

1 2 1 1 2 2  рицы гомографии в процессе полного перебора клю-
чевых точек. Ему отвечают пары точек: 6, 9, 14, 18 и 

 Z T B 
1

 T  матрица гомографии 
=  Z B2  . (6)  0,865 0,018 61,023
 T T
W1 B1 +W2 B   

2   0,045 0,910 40,303 . (7) 


2. Экспериментальные исследования.  −1,51×10−5 −2,06×10−5 1 


Оценка качества совмещения Это совмещение в дальнейшем мы будем рассмат-
В процессе апробирования алгоритмов были вы- ривать как эталонное. 

полнены эксперименты по совмещению пары изобра-
жений, полученных от однотипных датчиков (телеви-
зионных), а также от датчиков разных типов (видео- и 
тепловизионный датчики). В первом случае выполня-
лось совмещение видеоизображений островов, полу-
ченных с борта воздушного судна с задержкой в не-
сколько секунд. На рис. 1 приведен один из двух сопо-
ставляемых контуров островов, полученный в резуль-
тате предварительной обработки видеоизображения 
(обнаружение границ перепада яркости, замыкание 
контурных линий, аппроксимация замкнутых контуров 
многоугольниками, поиск ключевых точек и установ-
ление соответствия между ними). Знаком «звёздочка» 
с номерами указаны ключевые точки первого контура 
(18 точек). На горизонтальной и вертикальной осях  

Рис. 2. Лучшее из 3060 совмещений 
приведена масштабная сетка, которая автоматически 
формируется средствами пакета MATLAB и характе- Для оценки качества совмещения изображений, 
ризует размер изображений в пикселях. представленных контурами основных объектов, бы-

ла разработана специальная методика. Совмещение 
даже однородных изображений, но отличающихся 
временным сдвигом, невозможно осуществить иде-
ально (пиксель в пиксель). Если же производится 
совмещение разнородных изображений, то их иде-
альное совмещение невозможно в принципе из-за 
того, что на реальном изображении могут присут-
ствовать контуры объектов, которых нет на цифро-
вой карте местности (деревья, локальные изменения 
береговой линии и т.д.). Поэтому даже при хорошем 
(на визуальном уровне) совмещении контуров число 
совпавших пикселей двух изображений может быть 
относительно небольшим. Один из известных спо-

 собов получения более адекватных оценок качества 
Рис. 1. Контуры острова с найденными на нём совмещения контуров заключается в применении 

 ключевыми точками специальной процедуры утолщения тонких линий 
Аналогичный вид с точностью до проективных контуров. Однако добиться аналогичного результата 

искажений, обусловленных разницей во времени можно иначе, выполнив вычисления, имитирующие 
между съёмками, и локальных изменений, возник- утолщение линий контуров. 
ших на этапе морфологической обработки, имеет и Основная идея предлагаемого метода заключается 
второе изображение. Оно с целью экономии здесь не в следующем. Изображение разбивается на квадрат-
приводится. ные блоки (клетки) определённого размера, напри-
Для нахождения наилучшего варианта приведения мер, 100×100 пикселей. Это даёт возможность полу-

одного изображения к плоскости другого в работе [8] чать не только интегральную оценку качества совме-
был выполнен полный перебор сочетаний из 18 точек щения, но и локальные оценки в каждом из выделен-
по четыре точки. В итоге были построены 3060 мат- ных квадратных блоков. В каждой клетке для всех 

информативных (отличных от цвета фона) точек од-
риц гомографии (3060 = C 4

18 ) , выполнены совмеще- ного из изображений ищутся информативные точки 
ния изображений и в каждом случае оценено качество другого изображения, лежащие в некоторой квадрат-
такого совмещения. Матрицы гомографии в этом ва- ной окрестности размером (2k+1)×( 2k+1) с центром в 

260 Компьютерная оптика, 2016, том 40, №2 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

обрабатываемой информативной точке. Как правило, всему множеству пар ключевых точек с последующим 
k = 1 или k = 2. Значение k = 1 равносильно утолщению удалением из него «плохих» точек и вычислением но-
тонкой линии в один пиксель первого контура до трёх вой матрицы гомографии. Для сравнения получаемых 
пикселей, а k = 2 – до пяти.  совмещений использовались показатель качества сов-
Скользящее окно выбранного размера (в рассмат- мещения α, матрица гомографии и евклидово расстоя-

риваемом эксперименте 5×5) перемещается по стро- ние ρ( X i , HX ′
i ) , i = 1, k  между ключевыми точками 

кам изображения. Как только информативная точка 
первого изображения попадает в центр этой окрест- одного контура и отвечающими им образами точек 
ности, то ищутся и помечаются информативные пик- другого контура. Результат совмещения контуров ост-
сели второго изображения, попавшие в эту окрест- ровов с использованием всех 18 точек представлен на 
ность и не помеченные на предыдущих этапах. После рис. 3. Как визуальный анализ, так и анализ значений 
того, как выполнено сканирование всего изображе- перечисленных показателей свидетельствуют о том, 
ния, в каждом квадратном блоке подсчитывается чис- что данное совмещение далеко от идеального 
ло m (α

i помеченных точек совмещаемого (второго) кон-  = 0,176). Причина данного явления заключается в 
тура и находится отношение этого числа к общему том, что в наборе из 18 пар точек есть «неудачные». 
числу информативных точек Mi первого контура, т.е. Среднее значение расстояния в евклидовой мет-
α  рике между ключевыми точками первого контура и 

i = mi / Mi. Коэффициент αi логично назвать показа-
телем качества совмещения в i-м блоке изображения, отвечающими им образами точек второго контура 

а 1 k
коэффициент α = (∑mi ∑M i )  – интегральным ( R = ∑ ′

H ρ ( X
k i , HX i ) ) по всем 18 точкам равно 

i i i=1

показателем качества совмещения всего контура. 38,59. Тогда как для эталонного совмещения оно рав-
Интегральные оценки качества совмещения кон- но 18,41. Свидетельством неудачного совмещения 

туров для 9 лучших наборов из 4 пар ключевых точек является и матрица гомографии 
приведены в таблице. Данные результаты получены 

 0, 211 −0,206 429,72
при разбиении исходного изображения на блоки раз- 


мером 100×100 пикселей и значении параметра k = 2. − 

 0,144 0,320 301,69   
Исходные изображения островов имеют размер  − 

0,0003 0,0003 1 
1700×1500 пикселей. 

для данного варианта в сравнении с матрицей гомо-
Табл. 1. Показатели качества совмещения 

графии (7) эталонного совмещения. 
№ Показатель α 

Номер в наборе Набор точек 
п/п качества  

из 3060 групп (рис. 1) 
совмещения 

1 1959 4, 9, 12, 17 0,824 
2 1960 4, 9, 12, 18 0,805 
3 2017 4, 11, 14, 17 0,828 
4 2459 6, 9, 11, 17 0,815 
5 2460 6, 9, 11, 18 0,816 
6 2465 6, 9, 12, 17 0,835 
7 2474 6, 9, 14, 17 0,843 
8 2475 6, 9, 14, 18 0,848 
9 2538 6, 12, 11, 17 0,812 

 
Приведённые в табл. 1. результаты достаточно  

интересны. Визуальный анализ рис. 1 позволяет Рис. 3. Совмещение контуров с помощью матрицы 
предположить, что наилучшими должны были бы  гомографии, найденной по всем 18 ключевым точкам 
быть наборы ключевых точек 3, 10, 15 или 16, и 17 Анализ расстояний ρ( X i , X ′

i ) , i = 1,18  в евклидо-
или 18. Указанные наборы также дают достаточно 

вой метрике между соответствующими точками пер-
высокое качество совмещения, например, для набора 
3, 10, 15, 18 значение показателя α вого и второго контуров показал, что наибольшее 

 качества совме-
уклонение наблюдается на паре точек под номером 1 

щения равно 0,795. Однако приведённые в таблице 
оценки качества совмещения выше (все больше 0,8). ( ρ( X1 , X ′

1 ) = 192 ,87 ) (табл. 2). 
Для автоматизации процесса поиска наилучшего Удалим пару точек под номером 1 из набора и вы-
набора из 4 пар точек нужна специальная технология полним процедуру совмещения по набору из 17 то-
отбора таких точек. Второй вывод этого этапа иссле- чек. Результат этого совмещения приведён на рис. 4.  
дования – «хороший» набор из 4 точек на контуре не Уже визуальный анализ говорит о том, что поло-
единственен, важно лишь правильно его найти.  жение изменилось кардинально – совмещение близко 

На следующем этапе исследований поиск опти- к идеальному. Показатель качества в данном случае 
мальной матрицы гомографии выполнялся сразу по α = 0,730. 

Компьютерная оптика, 2016, том 40, №2 261 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

Табл. 2. Расстояния в пикселях между ключевыми точ- рые из них расположены близко друг к другу и, зна-
ками первого контура и образами соответствующих им чит, в каждой такой группе можно оставить только 

точек второго контура 
одну точку. Такие группы в нашем примере образу-

№ пары Расстояние между № пары Расстояние  ют, например, подмножества{4, 5, 6, 7}, {8, 9}, {17, 
точек точками точек между точками 18}. Сократим каждое подмножество до одной точки: 

1 192,87 10 113,95 {4, 5, 6, 7}→{4}, {8, 9}→{8}, {17, 18}→{17}. 
2 48,79 11 78,56 

Выполним теперь поиск матрицы гомографии с 
3 88,23 12 80,05 

удалённой парой под номером 1 и удалёнными пара-
4 61,74 13 58,83 

ми под номерами 5, 6, 7, 9, 18. Показатели качества 
5 64,35 14 38,07 

совмещения при этом ухудшились, но, заметим, со-
6 51,92 15 20,09 
7 67,23 16 32,01 всем несущественно: RH = 19,21 , α = 0,768, матрица 
8 22,47 17 53,85 гомографии 
9 29,61 18 51,47 

 0,943 0,048 26,65
 
 0,044 1,022 20, 26  
1,13×10−5
 3,99×10−5 1 


незначительно отличается от матрицы (8). Альтерна-
тивная и достаточно распространённая методика опре-
деления «оптимальных» значений параметров проек-
тивного преобразования заключается в использовании 
метода RANSAC. Для сопоставления предлагаемого ав-
торами подхода с результатами, которые даёт RANSAC, 
было проведено микроисследование. Оно заключалось в 
многократном (30 раз) запуске RANSAC на рассматри-
ваемом множестве из 18 пар ключевых точек, вычисле-
нии с его помощью матрицы гомографии, выполнении 

 совмещения и оценки качества совмещения. Результаты 
Рис. 4. Совмещение контуров по 17 ключевым точкам 

(без пары точек под номером 1) таковы: всего получено 9 различных матриц гомогра-
фии и соответственно вариантов совмещения, один из 

Это заключение подтверждается и объективными 
них оказался совершенно некачественным и повторился 

характеристиками: значение RH = 18,95  близко к оп- 6 раз в 30 экспериментах (рис. 5) (α = 0,056), 4 различ-
тимальному значению RH = 18,41 , матрица гомогра- ных варианта матриц гомографии с невысоким каче-
фии также несущественно отличается от матрицы (7) ством совмещения (рис. 6) (α = 0,214–0,368) и 4 вариан-

та матриц гомографии с хорошим качеством совмеще-
 0,941 0,052 21,93
  ния (α = 0,801), причём хорошие результаты совмеще-
 0,047 1,018 17,86 . (8) ния были получены только в 9 из 30 запусков RANSAC 
8,32×10−6
 3,74×10−5 1 

 (применялась версия RANSAC, реализуемая функцией 
estimateGeometricTransform из пакета MATLAB 

Теперь можно сформулировать критерии сокра- R2014a). 
щения множества пар ключевых точек. Мы должны Основные выводы данного этапа: 
исходить из того, что сокращение должно приводить - поиск матрицы гомографии необязательно осу-
либо к улучшению качества совмещения, либо не ществлять строго по 4 ключевым точкам, возможен 
должно существенно ухудшать его. Первое требова- расчёт по произвольному количеству ключевых точек; 
ние должно достигаться при удалении «плохих» клю- - соседние точки контуров, расстояние между ко-
чевых точек. Как правило, это пары точек, в которых торыми невелико, можно заменить одной из них, без 
расстояние ρ( X i , X ′

i )  между точками одного контура существенной потери качества; 
и отвечающими им точками другого контура суще- - если в исходном наборе пар ключевых точек есть 
ственно больше среднего расстояния по всему мно- пара, расстояние между которой существенно больше 
жеству ключевых точек. Второй критерий отсеива- среднего по множеству, то такая точка должна быть 
ния – выбор из нескольких близко расположенных удалена из набора. 
ключевых точек одной. Отметим, что близкие к нулю значения элементов 
По первому критерию, как это следует из табл. 2, h31, h32 в третьей строке найденных матриц гомогра-

должна быть удалена пара точек под номером 1 и, фии во всех экспериментах говорят фактически об от-
быть может, под номером 10. Выше было показано, сутствии проективных искажений между сравнивае-
что удаление пары точек под номером 1 кардинально мыми изображениями и, соответственно, о возможно-
меняет качество совмещения.  сти упрощения алгоритма. Однако предлагаемый ал-
Анализ расстояний между соседними точками на горитм рассчитан на использование в реальных авиа-

одном и втором контурах говорит о том, что некото- ционных СТЗ и должен учитывать возможное нали-

262 Компьютерная оптика, 2016, том 40, №2 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

чие проективных искажений между сравниваемыми ний подстилающей поверхности), полученные с этих 
изображениями. камер в некоторый момент времени, результат их сов-

мещения с помощью найденной матрицы гомографии 

 0,5 0,03 159,13 
− 
 0,02 0,55 174,64 . 
 
 0 0 1 
Также было выполнено совмещение других кад-

ров из видеоряда на протяжении всего полёта с по-
мощью найденной матрицы гомографии. Результат 
совмещения во всех случаях хороший. 

 
Рис. 5. Пример неудачного результата RANSAC 

а)  

 
Рис. 6. Пример результата RANSAC с невысоким 

качеством совмещения 
Приведём пример совмещения телевизионного и 

тепловизионного изображений. Телевизионная и теп-
ловизионная камеры жёстко закреплены на некотором 
расстоянии друг от друга на борту воздушного судна. 
Параметры камер: телевизионная – горизонтальный 
угол обзора – 41°, вертикальный – 30,7°, тепловизи-
онная система имеет поле зрения 20°×16° по горизон-
тали и вертикали соответственно. Поскольку положе-
ние камер в процессе полета не меняется, то есте-

б)  
ственно ожидать, что матрица гомографии для данно-
го фиксированного положения камер в процессе по-
лета также не будет меняться. Значит, можно выбрать 
любую пару чётких изображений подстилающей по-
верхности, содержащей чётко выделенные (на исход-
ном изображении) контуры объектов, отметить на них 
по 4 пары ключевых точек, пусть даже вручную, и 
вычислить матрицу гомографии. Проведённые экспе-
рименты подтвердили это предположение. Корректно 
рассчитанная один раз матрица гомографии обеспе-
чивала хорошее совмещение телевизионного и тепло-
визионного изображений на протяжении всего полёта. 
В качестве иллюстрации на рис. 7 приведены ис-

ходные изображения одного участка подстилающей 
поверхности (рис. 7а – тепловизионное изображение 
подстилающей поверхности, рис. 7б – чёрно-белое те- в)  
левизионное изображение, рис. 7в – результат совме- Рис. 7. Совмещение изображений  

подстилающей поверхности 
щения телевизионного и тепловизионного изображе-

Компьютерная оптика, 2016, том 40, №2 263 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

Заключение ний / Е.В. Гошин, А.П. Котов, В.А. Фурсов // Компью-
терная оптика. – 2014. – Т. 38, № 4. – С. 886-891. 

В статье предложена технология совмещения 
изображений в условиях 5. Алпатов, Б.А. Электронная юстировка изображений при 

неопределённости относи-
мультиспектральном наблюдении / Б.А. Алпатов, 

тельно качества сформированного множества ключе-
П.В. Бабаян // Цифровая обработка сигналов. – 2003. – 

вых точек. Технология основана на обнаружении и № 1. – С. 24-26. 
поэтапном отсеивании неудачных пар ключевых то- 6. Novikov, A.I. The Contour Analysis and Image-
чек. Приведена методика получения локальных и ин- Superimposition Problem in Computer Vision Systems / 
тегральных оценок качества совмещения изображе- A.I. Novikov, V.A. Sablina, M.B. Nikiforov, A.A. Loginov // 
ний. Приводятся результаты совмещения изображе- Pattern Recognition and Image Analysis. – 2015. – 
ний подстилающей поверхности с применением Vol. 25(1). – P. 73-80. – DOI: 10.1134/S1054661815020194. 
предлагаемого подхода. 7. Hast. A. Optimal RANSAC – Towards a Repeatable Algorithm 

for Finding the Optimal Set / A. Hast, J. Nysjö, A. Marchetti // 
Литература Journal of WSCG. – 2013. – Vol. 21(1). – P. 21-30. 

1. Баклицкий, В.К. Корреляционно-экстремальные мето- 8. Novikov, A.I. Image Superimposition and the Problem of Select-
ды навигации и наведения / В.К. Баклицкий. – Тверь: ing the Set of Corresponding Point Pairs / A.I. Novikov, V.A. Sa-
ТО «Книжный клуб», 2009. – 360 с. blina, A.I. Efimov // 4th Conference on Embedded Computing 

2. Введение в контурный анализ. Приложения к обработке (MECO) Proceedings, Budva, Montenegro. – 2015. – P. 139-142. 
изображений и сигналов / Я.А. Фурман, А.В. Кревецкий, 9. Herbert, B. Speeded-Up Robust Features (SURF) / B. Herbert, 
А.К. Передреев, А.А. Роженцов, Р.Г. Хафазов, И.Л. Его- E. Andreas, T. Tinne, L. Van Gool // Computer Vision and 
шина, А.Н. Леухин; под ред. Я.А. Фурмана. – Изд. 2-е, Image Understanding. – 2008. – Vol. 110, Issue 3. – P. 346-
испр. – М.: Физматлит, 2003. – 592 с. 359. – DOI: 10.1016/j.cviu.2007.09.014. 

3. Грузман, И.С. Цифровая обработка изображений в ин- 10. Lowe, D. Distinctive Image Features from Scale-Invariant 
формационных системах / И.С. Грузман, В.С. Киричук, Keypoints / D.G. Lowe // International Journal of Computer 
В.П. Косых, Г.И. Перетрягин, А.А. Спектор. – Новоси- Vision. – 2004. – Vol 60, Issue 2. – P. 91-110. 
бирск: Изд-во НГТУ, 2002. – 351 с. 11. Демидович, Б.П. Основы вычислительной математики: 

4. Гошин, Е.В. Двухэтапное формирование простран- учеб. пособие / Б.П. Демидович, И.А. Марон; под общ. 
ственного преобразования для совмещения изображе- ред. Б.П. Демидовича. – 2-е изд., испр. – М.: Физматгиз, 

1963. – 659 с. 
 
 

Сведения об авторах 
Ефимов Алексей Игоревич, 1990 года рождения, в 2013 году окончил Рязанский государственный радиотехниче-

ский университет по специальности 23.01.01 «Вычислительные машины, комплексы, системы и сети», работает инже-
нером в научно-образовательном центре «СпецЭВМ» РГРТУ. Область научных интересов: обработка графических 
изображений, программирование. E-mail: lexie62rus@mail.ru . 

 
Новиков Анатолий Иванович, 1950 года рождения, в 1972 году окончил механико-математический факультет 

Горьковского государственного университета имени Н.И. Лобаческого (ныне – Нижегородский государственный уни-
верситет имени Н.И. Лобачевского) по специальности «Прикладная математика», работает доцентом кафедры высшей 
математики Рязанского государственного радиотехнического университета. Область научных интересов: математиче-
ские методы обработки изображений, анализ временных рядов, численные методы линейной алгебры.  
E-mail: novikovanatoly@yandex.ru .  
 
 

Поступила в редакцию 18 января 2016 г. Окончательный вариант – 21 февраля 2016 г. 
 
 

AN ALGORITHM FOR MULTISTAGE PROJECTIVE TRANSFORMATION ADJUSTMENT FOR IMAGE 
SUPERIMPOSITION 

A.I. Efimov 1, A.I. Novikov 1 
1 Ryazan State Radio Engineering University, Ryazan, Russia 

Abstract  
We propose a multistage algorithm for constructing a projective transformation based on arbitrary 

sets of keypoint pairs, with the sets containing more than four keypoint pairs. In the course of calcu-
lation of a homography matrix, unsuccessful keypoint pairs are detected and rejected. Experimental 
results on image superimposition using projective transformations for homogeneous and heterogene-
ous images are presented. Methods for assessing the quality of image superimposition, which include  
the local and integral estimates of the superimposition quality, are proposed. 

Keywords: mixed-spectrum images, contour analysis methods, keypoints (special, correspond-
ing), projective transformations, homography matrix, quality of image superimposition.  

Citation: Efimov AI, Novikov AI. An algorithm for multistage projective transformation ad-
justment for image superimposition. Computer Optics 2016; 40(2): 258-265. DOI: 10.18287/2412-
6179-2016-40-2-258-265. 

264 Компьютерная оптика, 2016, том 40, №2 



Алгоритм поэтапного уточнения проективного преобразования для совмещения изображений Ефимов А.И., Новиков А.И. 

References 
[1] Baklickiy VK. Correlation-extreme methods of navigation and guidance [In Russian]. Tver: “Knizhniy Klub” Publisher; 2009.  
[2] Furman YaA, Kreveckiy AV, Peredreev AK, Rozhencov AA, Hafazov RG, Egoshina IL, Leuhin AN. Introduction to the contour 

analysis. Applications to image and signal processing [In Russian]. Moscow: “Fizmatlit” Publisher; 2003. 
[3] Gruzman IS, Kirichuk VS, Kosih VP, Peretryagin GI, Spector AA. Digital image processing in information systems [In Russian]. No-

vosibirsk: “Novosibirsk State Technical University” Publisher; 2002. 
[4] Goshin EV, Kotov AP, Fursov VA. Two-stage formation of a spatial transformation for image matching. Computer Optics 2014; 

38(4): 886-891. 
[5] Alpatov BA, Babayan PV. Digital adjustment of multispectral images observation [In Russian]. Digital signal processing 2003; 1: 24-26. 
[6] Novikov AI, Sablina VA, Nikiforov MB, Loginov AA. The contour analysis and image-superimposition problem in computer 

vision systems. Pattern Recognition and Image Analysis 2015; 25(1): 73-80. DOI: 10.1134/S1054661815020194 
[7] Hast A, Nysjö J, Marchetti A. Optimal RANSAC – towards a repeatable algorithm for finding the optimal set. Journal of 

WSCG 2013; 21(1): 21-30. 
[8] Novikov AI, Sablina VA, Efimov AI. Image Superimposition and the Problem of Selecting the Set of Corresponding Point 

Pairs. Proceedings of MECO 2015: 139-142. 
[9] Herbert B, Andreas E, Tinne T, Van Gool L. Speeded-Up Robust Features (SURF). Computer Vision and Image Understand-

ing 2008; 110(3): 346-359. 
[10] Lowe, DG. Distinctive Image Features from Scale-Invariant Keypoints. International Journal of Computer Vision 2004; 60(2): 

91-110. 
[11] Demidovich BP, Maron IA. Fundamentals of Computational Mathematics [In Russian]. Moscow: “Fizmatgiz” Publisher; 1963. 
 
 

Authors’ information  
Aleksey Igorevich Efimov (b. 1990) graduated from Ryazan State Radioengineering University in 1990, majoring 

in Electronic Machines, Systems and Networks. Currently he works as the engineer at the RSREU education and re-
search center of specialized computers. Research interests are computer graphics processing and programming. E-mail: 
lexie62rus@mail.ru . 

 
Anatoly Ivanovich Novikov (b. 1950) graduated from Mechanics and Mathematics faculty of Gorky State Univer-

sity named after NI Lobachesky (now - Nizhny Novgorod State University named after Lobachevsky) in 1972, major-
ing in Applied Mathematics. Currently he works as associate professor at Higher Mathematics department in RSREU. 
Research interests are computer graphics processing, time series analysis, numerical methods of linear algebra. E-mail: 
novikovanatoly@yandex.ru . 

 
 
 

Received January 18, 2016. The final version – February 21, 2016. 
 

 

Компьютерная оптика, 2016, том 40, №2 265